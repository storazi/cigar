<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비흡연자의 쉬는시간 - 시가 계산기</title>
<style>
    :root {
        --bg-main: #f4f1ea;
        --bg-panel: #ffffff;
        --border-main: #d1cdc0;
        --border-sub: #e2dfd5;
        --accent-main: #7a8b7c;
        --accent-soft: rgba(122, 139, 124, 0.1);
        --accent-gold: #8d7b68;
        --text-main: #4a4a4a;
        --text-sub: #7d7d7d;
    }

    body {
        margin: 0; padding: 0;
        background: radial-gradient(circle at top, #fdfcf9, #ebe7dc);
        font-family: 'Pretendard', system-ui, -apple-system, sans-serif;
        color: var(--text-main);
        min-height: 100vh;
    }

    .container {
        max-width: 480px;
        margin: 20px auto;
        padding: 25px;
        background: var(--bg-panel);
        border: 1px solid var(--border-main);
        border-radius: 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    h1 { text-align: center; margin-bottom: 20px; font-size: 24px; font-weight: 700; color: var(--accent-gold); }

    .intro {
        margin-bottom: 25px; padding: 15px; background: #fdfcfb;
        border: 1px solid var(--border-sub); border-radius: 14px;
        line-height: 1.6; text-align: center; color: var(--text-sub); font-size: 13px;
    }

    .input-group { position: relative; margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; }

    #pet-name {
        width: 100%; padding: 14px; font-size: 16px; border: 1px solid var(--border-main);
        border-radius: 12px; box-sizing: border-box;
    }

    .stat-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .stat-label { font-size: 15px; font-weight: 600; }
    .stat-label span { font-size: 11px; color: var(--text-sub); font-weight: normal; }

    .control-group { display: flex; align-items: center; gap: 6px; }

    input[type="number"] {
        width: 65px; height: 44px; font-size: 17px; font-weight: 600;
        border: 1px solid var(--border-main); border-radius: 10px;
        text-align: center; background: #fafafa;
    }

    .btn-step {
        width: 44px; height: 44px; border: 1px solid var(--border-main);
        background: #fdfcf9; border-radius: 10px; font-size: 22px;
        font-weight: bold; color: var(--accent-gold); cursor: pointer;
        display: flex; align-items: center; justify-content: center;
    }

    .btn-step:active { background: var(--accent-soft); transform: scale(0.95); }

    #suggestions {
        list-style: none; padding: 0; margin: 0; position: absolute;
        top: 100%; left: 0; right: 0; background: #fff;
        border: 1px solid var(--accent-main); border-radius: 0 0 12px 12px;
        max-height: 200px; overflow-y: auto; z-index: 999; display: none;
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    #suggestions li { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid var(--border-sub); }

    button#calculate-btn {
        width: 100%; margin-top: 25px; padding: 18px; font-size: 18px;
        font-weight: 700; background: linear-gradient(180deg, #8b9a8d, #7a8b7c);
        color: #fff; border: none; border-radius: 12px; cursor: pointer;
    }

    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .result { margin-top: 25px; padding: 20px; background: #f9f8f6; border: 1px dotted var(--border-main); border-radius: 14px; text-align: center; min-height: 50px; }
    #loading { display: none; text-align: center; margin-top: 15px; color: var(--accent-main); }
</style>
</head>
<body>
    <div class="container">
        <h1>시가 계산기</h1>
        <div class="intro">
            <strong>업데이트 : 2026/02/12</strong><br>
            정석 대비 <strong>차이값(+/-)</strong>을 입력하세요.
        </div>

        <div class="input-group">
            <label for="pet-name">페트 이름</label>
            <input type="text" id="pet-name" placeholder="데이터 불러오는 중..." autocomplete="off" disabled>
            <ul id="suggestions"></ul>
        </div>

        <div class="stat-row">
            <div class="stat-label">체력 차이 <span>(정석 대비)</span></div>
            <div class="control-group">
                <input type="number" id="diff-health" value="0">
                <button class="btn-step" onclick="step('diff-health', -1)">-</button>
                <button class="btn-step" onclick="step('diff-health', 1)">+</button>
            </div>
        </div>

        <div class="stat-row">
            <div class="stat-label">공격력 차이</div>
            <div class="control-group">
                <input type="number" id="diff-attack" value="0">
                <button class="btn-step" onclick="step('diff-attack', -1)">-</button>
                <button class="btn-step" onclick="step('diff-attack', 1)">+</button>
            </div>
        </div>

        <div class="stat-row">
            <div class="stat-label">방어력 차이</div>
            <div class="control-group">
                <input type="number" id="diff-defense" value="0">
                <button class="btn-step" onclick="step('diff-defense', -1)">-</button>
                <button class="btn-step" onclick="step('diff-defense', 1)">+</button>
            </div>
        </div>

        <div class="stat-row">
            <div class="stat-label">순발력 차이</div>
            <div class="control-group">
                <input type="number" id="diff-agility" value="0">
                <button class="btn-step" onclick="step('diff-agility', -1)">-</button>
                <button class="btn-step" onclick="step('diff-agility', 1)">+</button>
            </div>
        </div>

        <button id="calculate-btn" disabled>데이터 대기 중</button>

        <div id="result" class="result">페트 이름을 먼저 선택해 주세요.</div>
        <div id="loading">계산 중입니다...</div>
    </div>

    <script>
        let petData = {};
        let currentIdealStats = null;

        // 1. JSON 파일 읽어오기
        async function loadPetData() {
            try {
                const response = await fetch('pet.json');
                if (!response.ok) throw new Error('파일을 찾을 수 없습니다.');
                petData = await response.json();
                
                // 데이터 로드 성공 시 입력창 활성화
                const nameInput = document.getElementById("pet-name");
                nameInput.disabled = false;
                nameInput.placeholder = "이름 또는 초성 입력";
                document.getElementById("calculate-btn").innerText = "계산하기";
                document.getElementById("calculate-btn").disabled = false;
            } catch (error) {
                console.error('데이터 로드 실패:', error);
                document.getElementById("result").innerText = "데이터(pet.json)를 불러오는데 실패했습니다.";
            }
        }

        loadPetData();

        function step(id, val) {
            const el = document.getElementById(id);
            el.value = parseInt(el.value || 0) + val;
        }

        function getChosung(str) {
            const cho = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
            let result = "";
            for(let i=0; i<str.length; i++) {
                let code = str.charCodeAt(i) - 44032;
                if(code > -1 && code < 11172) result += cho[Math.floor(code/588)];
                else result += str.charAt(i);
            }
            return result;
        }

        function calculateIdealStats(pet) {
            const bH = pet.healthCoefficient + 4.5;
            const bA = pet.attackCoefficient + 4.5;
            const bD = pet.defenseCoefficient + 4.5;
            const bG = pet.agilityCoefficient + 4.5;
            const iH = (bH * pet.initialCoefficient) / 100;
            const iA = (bA * pet.initialCoefficient) / 100;
            const iD = (bD * pet.initialCoefficient) / 100;
            const iG = (bG * pet.initialCoefficient) / 100;
            return {
                health: Math.floor(iH * 4 + iA + iD + iG),
                attack: Math.floor(iH * 0.1 + iA + iD * 0.1 + iG * 0.05),
                defense: Math.floor(iH * 0.1 + iA * 0.1 + iD + iG * 0.05),
                agility: Math.floor(iG)
            };
        }

        const petNameInput = document.getElementById("pet-name");
        const suggestions = document.getElementById("suggestions");

        petNameInput.addEventListener("input", () => {
            const query = petNameInput.value.trim();
            suggestions.innerHTML = "";
            if (!query) { suggestions.style.display = "none"; return; }
            const queryChosung = getChosung(query);
            const matches = Object.keys(petData).filter(name => 
                name.includes(query) || getChosung(name).includes(queryChosung)
            );
            if (matches.length > 0) {
                suggestions.style.display = "block";
                matches.forEach(match => {
                    const li = document.createElement("li");
                    li.textContent = match;
                    li.onclick = () => {
                        petNameInput.value = match;
                        suggestions.style.display = "none";
                        currentIdealStats = calculateIdealStats(petData[match]);
                        document.getElementById("result").innerText = "스탯 차이를 입력하고 계산을 눌러주세요.";
                    };
                    suggestions.appendChild(li);
                });
            } else { suggestions.style.display = "none"; }
        });

        document.getElementById("calculate-btn").addEventListener("click", () => {
            const name = petNameInput.value;
            if (!petData[name] || !currentIdealStats) {
                alert("정확한 페트 이름을 선택해주세요!");
                return;
            }

            document.getElementById("loading").style.display = "block";
            document.getElementById("result").innerHTML = "";

            setTimeout(() => {
                const tH = currentIdealStats.health + parseInt(document.getElementById("diff-health").value || 0);
                const tA = currentIdealStats.attack + parseInt(document.getElementById("diff-attack").value || 0);
                const tD = currentIdealStats.defense + parseInt(document.getElementById("diff-defense").value || 0);
                const tG = currentIdealStats.agility + parseInt(document.getElementById("diff-agility").value || 0);

                const pet = petData[name];
                let matched = 0, hCases = 0;

                for (let hR = -2; hR <= 2; hR++) {
                    for (let aR = -2; aR <= 2; aR++) {
                        for (let dR = -2; dR <= 2; dR++) {
                            for (let gR = -2; gR <= 2; gR++) {
                                for (let hB = 0; hB <= 10; hB++) {
                                    for (let aB = 0; aB <= 10; aB++) {
                                        for (let dB = 0; dB <= 10; dB++) {
                                            const gB = 10 - hB - aB - dB;
                                            if (gB < 0 || gB > 10) continue;

                                            const iH = ((pet.healthCoefficient + hR + hB) * pet.initialCoefficient) / 100;
                                            const iA = ((pet.attackCoefficient + aR + aB) * pet.initialCoefficient) / 100;
                                            const iD = ((pet.defenseCoefficient + dR + dB) * pet.initialCoefficient) / 100;
                                            const iG = ((pet.agilityCoefficient + gR + gB) * pet.initialCoefficient) / 100;

                                            if (Math.floor(iH * 4 + iA + iD + iG) === tH &&
                                                Math.floor(iH * 0.1 + iA + iD * 0.1 + iG * 0.05) === tA &&
                                                Math.floor(iH * 0.1 + iA * 0.1 + iD + iG * 0.05) === tD &&
                                                Math.floor(iG) === tG) {
                                                matched++;
                                                if (hR === 2 && aR === 2 && dR === 2 && gR === 2) hCases++;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                if (matched === 0) {
                    document.getElementById("result").textContent = "존재할 수 없는 스탯 조합입니다.";
                } else {
                    const p = ((hCases / matched) * 100).toFixed(2);
                    const realP = p === "100.00" ? "99.9" : p;
                    const expected = p > 0 ? (100 / p).toFixed(1) : "∞";
                    document.getElementById("result").innerHTML = `
                        <div>성공 확률 : <strong>${realP}%</strong></div>
                        <div style="margin-top:10px; font-size:14px; color:var(--text-sub);">
                            성공 기대값 : 약 <strong>${expected}번</strong> 시도<br>
                            <span style="font-size:11px;">(목표 스탯: ${tH} ${tA} ${tD} ${tG})</span>
                        </div>`;
                }
                document.getElementById("loading").style.display = "none";
            }, 500);
        });


    </script>

<footer style="text-align: center; margin: 40px 0 20px 0; padding: 20px 0;">
        <div style="margin-bottom: 10px;">
            <a href="https://hits.sh/storazi.github.io/cigar/">
                <img alt="Hits" src="https://hits.sh/storazi.github.io/cigar.svg?view=today-total&style=flat-square&label=VISITORS&color=7a8b7c&labelColor=4a4a4a"/>
            </a>
        </div>
        <p style="font-size: 12px; color: var(--text-sub); opacity: 0.8;">
            © 2026 sup_bot All rights reserved.
        </p>
    </footer>

</body>
</html>
